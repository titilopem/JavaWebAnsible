---
- name: Deploy WAR file to Tomcat
  hosts: group1
  gather_facts: true
  become: yes

  vars:
    workspace: "{{ workspace | default('/home/centos/workspace/ansibleproject') }}"
    tomcat_home: "/usr/local/bin/apache-tomcat-10.1.16"

  tasks:
    - name: Fetch the latest WAR file
      ansible.builtin.fetch:
        src: "{{ workspace }}"
        dest: "{{ tomcat_home }}/webapps/"
        flat: yes
        force: yes
      register: fetch_result

    - name: Check if Tomcat is running
      ansible.builtin.shell:
        cmd: "{{ tomcat_home }}/bin/version.sh"
      register: tomcat_version
      ignore_errors: true

    - name: Stop Tomcat if running
      ansible.builtin.shell:
        cmd: "{{ tomcat_home }}/bin/shutdown.sh"
      when: tomcat_version.rc == 0 and fetch_result.changed

    - name: Start Tomcat
      ansible.builtin.shell:
        cmd: "{{ tomcat_home }}/bin/startup.sh"
      when: tomcat_version.rc == 0 and fetch_result.changed
...
